
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Pandas · GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-disqus/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="python-misc-tips.html" />
    
    
    <link rel="prev" href="logging.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    About
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" >
            
                <span>
            
                    
                    AI
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" data-path="../ai/reading__15-TYPES-OF-REGRESSION-YOU-SHOULD-KNOW.html">
            
                <a href="../ai/reading__15-TYPES-OF-REGRESSION-YOU-SHOULD-KNOW.html">
            
                    
                    Reading Notes -- 15 Types of Regression You Should Know
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" >
            
                <span>
            
                    
                    C++
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="../cpp/preprocessor_output.html">
            
                <a href="../cpp/preprocessor_output.html">
            
                    
                    Pre-processor Output
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2" >
            
                <span>
            
                    
                    SWIG
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.2.1" data-path="../cpp/swig/swig_misc.html">
            
                <a href="../cpp/swig/swig_misc.html">
            
                    
                    SWIG - MISC
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.2" data-path="../cpp/swig/call_cpp_by_swig.html">
            
                <a href="../cpp/swig/call_cpp_by_swig.html">
            
                    
                    Call C++ function by SWIG
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.3" data-path="../cpp/swig/send_dict_to_cpp.html">
            
                <a href="../cpp/swig/send_dict_to_cpp.html">
            
                    
                    Send dict to C++ function
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3.3" data-path="../cpp/gdb.html">
            
                <a href="../cpp/gdb.html">
            
                    
                    Setup GDB on Macos
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.4" data-path="../cpp/cpp_misc.html">
            
                <a href="../cpp/cpp_misc.html">
            
                    
                    C++ MISC
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.5" data-path="../cpp/book.html">
            
                <a href="../cpp/book.html">
            
                    
                    Books
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="divider"></li>
        
        
    
        <li class="chapter " data-level="2.1" >
            
                <span>
            
                    
                    CPLEX
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.1.1" data-path="../cplex/config_cplex_in_eclipse_cpp.html">
            
                <a href="../cplex/config_cplex_in_eclipse_cpp.html">
            
                    
                    Configurate Eclipse C++ IDE to use CPLEX
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.2" data-path="../cplex/config_xcode_for_cplex.html">
            
                <a href="../cplex/config_xcode_for_cplex.html">
            
                    
                    Config XCode to use CPLEX
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2.2" >
            
                <span>
            
                    
                    Docker
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.2.1" data-path="../docker/mssql_in_docker.html">
            
                <a href="../docker/mssql_in_docker.html">
            
                    
                    MSSQL in Docker
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2.2" data-path="../docker/nginx_in_docker.html">
            
                <a href="../docker/nginx_in_docker.html">
            
                    
                    Nginx in Docker
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2.3" data-path="../docker/reading__Docker架设Nginx服务器.html">
            
                <a href="../docker/reading__Docker架设Nginx服务器.html">
            
                    
                    Docker架设Nginx服务器
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2.3" >
            
                <span>
            
                    
                    GIT
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.3.1" data-path="../git/add_existing_codes_to_GIT.html">
            
                <a href="../git/add_existing_codes_to_GIT.html">
            
                    
                    Add Existing Codes to GIT Repo
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.3.2" data-path="../git/use-BFG-delete-large-files-from-history.html">
            
                <a href="../git/use-BFG-delete-large-files-from-history.html">
            
                    
                    Use BFG to delete large files from history
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.3.3" data-path="../git/git_proxy.html">
            
                <a href="../git/git_proxy.html">
            
                    
                    Proxy Setting in GIT
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2.4" >
            
                <span>
            
                    
                    Java
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.4.1" data-path="../java/java轻量RESTful_api服务搭建-jersey_jetty.html">
            
                <a href="../java/java轻量RESTful_api服务搭建-jersey_jetty.html">
            
                    
                    Jersey_jetty
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2.5" >
            
                <span>
            
                    
                    Linux
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.5.1" data-path="../linux/backup_setting_installed.html">
            
                <a href="../linux/backup_setting_installed.html">
            
                    
                    Backup settings and list of installed packages
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.5.2" data-path="../linux/bash_configuration.html">
            
                <a href="../linux/bash_configuration.html">
            
                    
                    .bash_profile & .bashrc
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.5.3" data-path="../linux/things_to_do_after_install.html">
            
                <a href="../linux/things_to_do_after_install.html">
            
                    
                    Things TODO after installation
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.5.4" data-path="../linux/ubuntu_misc.html">
            
                <a href="../linux/ubuntu_misc.html">
            
                    
                    Ubuntu Tricks
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2.6" data-path="../maven.html">
            
                <a href="../maven.html">
            
                    
                    Maven
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.7" data-path="../proxy.html">
            
                <a href="../proxy.html">
            
                    
                    Proxy
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.8" >
            
                <span>
            
                    
                    Python
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.8.1" data-path="multi-value_function.html">
            
                <a href="multi-value_function.html">
            
                    
                    About arg and *kwarg
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.8.2" data-path="django.html">
            
                <a href="django.html">
            
                    
                    Django Tips
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.8.3" data-path="logging.html">
            
                <a href="logging.html">
            
                    
                    Logging
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="2.8.4" data-path="pandas.html">
            
                <a href="pandas.html">
            
                    
                    Pandas
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.8.5" data-path="python-misc-tips.html">
            
                <a href="python-misc-tips.html">
            
                    
                    Misc Tips
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2.9" data-path="../web.html">
            
                <a href="../web.html">
            
                    
                    Web
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.10" data-path="../for_son.html">
            
                <a href="../for_son.html">
            
                    
                    科普
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >Pandas</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="pandas-tricks">Pandas Tricks</h1>
<h2 id="avoid-int-to-float-when-dfttodictvalues">Avoid <code>Int to Float</code> when <code>df.T.to_dict().values()</code></h2>
<p>Instead of use <code>list(df.T.to_dict().values())</code>, use <strong><code>[{c:getattr(r, c) for c in df} for r in df.itertuples()]</code></strong></p>
<blockquote>
<p>Ref: <a href="https://stackoverflow.com/questions/37897527/get-python-pandas-to-dict-with-orient-records-but-without-float-cast" target="_blank">https://stackoverflow.com/questions/37897527/get-python-pandas-to-dict-with-orient-records-but-without-float-cast</a></p>
</blockquote>
<pre><code class="lang-python"><span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd

df = pd.DataFrame({<span class="hljs-string">&apos;a&apos;</span>:[<span class="hljs-number">3</span>,<span class="hljs-number">2</span>], <span class="hljs-string">&apos;b&apos;</span>:[<span class="hljs-number">42.0</span>,<span class="hljs-number">3.14</span>]})
result = [{col:getattr(row, col) <span class="hljs-keyword">for</span> col <span class="hljs-keyword">in</span> df} <span class="hljs-keyword">for</span> row <span class="hljs-keyword">in</span> df.itertuples()]
print(result)
<span class="hljs-comment"># [{&apos;a&apos;: 3, &apos;b&apos;: 42.0}, {&apos;a&apos;: 2, &apos;b&apos;: 3.1400000000000001}]</span>
</code></pre>
<h2 id="read-excel">Read Excel</h2>
<pre><code class="lang-python">xl = pd.ExcelFile(fn)

<span class="hljs-comment"># read Sheets as DataFrames</span>
NaN_List = [<span class="hljs-string">&apos;-1.#IND&apos;</span>, <span class="hljs-string">&apos;1.#QNAN&apos;</span>, <span class="hljs-string">&apos;1.#IND&apos;</span>, <span class="hljs-string">&apos;-1.#QNAN&apos;</span>, <span class="hljs-string">&apos;#N/A&apos;</span>, <span class="hljs-string">&apos;#NA&apos;</span>, <span class="hljs-string">&apos;NULL&apos;</span>, <span class="hljs-string">&apos;NaN&apos;</span>, <span class="hljs-string">&apos;-NaN&apos;</span>, <span class="hljs-string">&apos;nan&apos;</span>, <span class="hljs-string">&apos;-nan&apos;</span>]  <span class="hljs-comment"># Nashville term is NA</span>
df_Node = xl.parse(<span class="hljs-string">&quot;Node&quot;</span>, converters={<span class="hljs-string">&apos;milepost&apos;</span>: str}, keep_default_na=<span class="hljs-keyword">False</span>, na_values=NaN_List)
df_Segment = xl.parse(<span class="hljs-string">&quot;Segment&quot;</span>, converters={<span class="hljs-string">&apos;startNode&apos;</span>: str, <span class="hljs-string">&apos;endNode&apos;</span>: str}, keep_default_na=<span class="hljs-keyword">False</span>, na_values=NaN_List)
</code></pre>
<h2 id="set-display-format">Set display format</h2>
<pre><code class="lang-python"><span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd

pd.set_option(<span class="hljs-string">&apos;display.width&apos;</span>,<span class="hljs-number">200</span>)
pd.set_option(<span class="hljs-string">&apos;display.max_rows&apos;</span>,<span class="hljs-number">20</span>)
pd.set_option(<span class="hljs-string">&apos;display.max_columns&apos;</span>, <span class="hljs-number">15</span>)
pd.set_option(<span class="hljs-string">&apos;display.precision&apos;</span>, <span class="hljs-number">3</span>)
</code></pre>
<h2 id="iterate-dataframe-by-rows">Iterate DataFrame by rows</h2>
<pre><code class="lang-python"><span class="hljs-keyword">for</span> i,r <span class="hljs-keyword">in</span> df.iterrows():
    <span class="hljs-keyword">if</span> pd.isnull(r[<span class="hljs-string">&apos;OSRM_meter&apos;</span>]):
        url = createURL(r)
</code></pre>
<h2 id="new-calculated-column">New calculated column</h2>
<pre><code class="lang-python">df.loc[:, <span class="hljs-string">&apos;diff&apos;</span>] = df.apply(<span class="hljs-keyword">lambda</span> r: r[<span class="hljs-string">&apos;c1&apos;</span>] - r[<span class="hljs-string">&apos;c2&apos;</span>], axis=<span class="hljs-number">1</span>)
</code></pre>
<h2 id="filter-by-conditions">Filter by conditions</h2>
<pre><code class="lang-python">cond1 = df[<span class="hljs-string">&apos;Project&apos;</span>].map(<span class="hljs-keyword">lambda</span> x: x <span class="hljs-keyword">in</span> [<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>])
cond2 = df[<span class="hljs-string">&apos;type&apos;</span>].map(<span class="hljs-keyword">lambda</span> x: x == <span class="hljs-string">&apos;TODO&apos;</span>)
df[cond1 &amp; cond2][<span class="hljs-string">&apos;SQL&apos;</span>]
</code></pre>
<h2 id="get-row-index-of-filtered-dataset">Get row index of filtered dataset</h2>
<pre><code class="lang-python">cond1 = df[<span class="hljs-string">&apos;entry_ts&apos;</span>].map(<span class="hljs-keyword">lambda</span> x: x &lt;= aTime)
cond2 = df[<span class="hljs-string">&apos;next_entry_ts&apos;</span>].map(<span class="hljs-keyword">lambda</span> x: x &gt; aTime)
s = df[cond1 &amp; cond2]
idx = s.index.tolist()
</code></pre>
<h2 id="add-row-index-as-new-column">Add row index as new column</h2>
<pre><code class="lang-python">g.loc[:,<span class="hljs-string">&apos;seq&apos;</span>] = pd.Seies([i+<span class="hljs-number">1</span> <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(len(g))], index=g.index)
</code></pre>
<h2 id="select-rows-whose-field-value-not-in-list--dict--series">Select rows whose field value not in list / dict / Series</h2>
<pre><code class="lang-python">aList = <span class="hljs-string">&apos;EGKNTUVW&apos;</span>
df = df[~df.t1.isin([c <span class="hljs-keyword">for</span> c <span class="hljs-keyword">in</span> aList])]
</code></pre>
<h2 id="read-from-excel">Read from Excel</h2>
<pre><code class="lang-python">xl = pd.ExcelFile(fn)
df = xl.parse(<span class="hljs-string">&apos;sheet1&apos;</span>)
</code></pre>
<h2 id="read-from-csv">Read from CSV</h2>
<pre><code class="lang-python">df = pd.read_csv(fn, index_col=false)
</code></pre>
<h2 id="parse-datetime-while-reading-from-csv">Parse datetime while reading from CSV</h2>
<pre><code class="lang-python">parseFunc = <span class="hljs-keyword">lambda</span> x: pd.datetime.strptime(x, <span class="hljs-string">&apos;%Y-%m-%d %H:%M:%S&apos;</span>)
df = pd.read_csv(fn, parse_dates=[<span class="hljs-string">&apos;startDate&apos;</span>], date_parser=parseFunc)
</code></pre>
<h2 id="read-df-from-stored-procedure">Read DF from Stored Procedure</h2>
<pre><code class="lang-python"><span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd
<span class="hljs-keyword">import</span> pandas.io.sql <span class="hljs-keyword">as</span> psql
<span class="hljs-keyword">import</span> pyodbc

connStr =<span class="hljs-string">&apos;DRIVER={};SERVER={};DATABASE={};UID={};PWD={}&apos;</span>.format(
    <span class="hljs-string">&apos;{SQL Server}&apos;</span>,
    <span class="hljs-string">&apos;MS_SQLServer_name&apos;</span>,
    <span class="hljs-string">&apos;DB_name&apos;</span>,
    <span class="hljs-string">&apos;username&apos;</span>,
    <span class="hljs-string">&apos;password&apos;</span>
)
conn = pyodbc.connect(connStr)

<span class="hljs-comment"># SP with no parameters</span>
df = psql.read_sql(<span class="hljs-string">&quot;{call  p_GetOPRP_TP_05}&quot;</span>, conn)

<span class="hljs-comment"># SP with parameters</span>
df = psql.read_sql(<span class="hljs-string">&quot;{{call  LOR_SIM.dbo.p_getTM2({0}, &apos;{1}&apos;)}}&quot;</span>.format(
    param.SCENARIO_ID, 
    subdiv
), conn)
</code></pre>
<h2 id="groupby-getgroup-get-group-size">Groupby(), get_group(), get group size</h2>
<pre><code class="lang-python">grp = df.groupby([<span class="hljs-string">&apos;TRAIN_ID&apos;</span>])
g = grp.get_group(<span class="hljs-string">&apos;Q123&apos;</span>)
sizeDict = grp.size().to_dict()
</code></pre>
<h2 id="iterate-group-and-sort-by-columns">Iterate group and sort by columns</h2>
<pre><code class="lang-python"><span class="hljs-keyword">for</span> tid <span class="hljs-keyword">in</span> df_tm6_grp.groups.keys():
    g = df_tm6_grp.get_group(tid)
    g = g.sort_values(by=[<span class="hljs-string">&apos;ON_STATION_TS&apos;</span>], ascending=[<span class="hljs-keyword">True</span>])

df.sort_values(by=[<span class="hljs-string">&apos;trainID&apos;</span>, <span class="hljs-string">&apos;stationSeq&apos;</span>], ascending=[<span class="hljs-keyword">True</span>, <span class="hljs-keyword">True</span>], inplace=<span class="hljs-keyword">True</span>)
</code></pre>
<h2 id="groupby-aggregate">Groupby aggregate</h2>
<pre><code class="lang-python">tmp = df.groupby([<span class="hljs-string">&apos;start_MP&apos;</span>, <span class="hljs-string">&apos;end_MP&apos;</span>]).agg({
    <span class="hljs-string">&apos;runTime&apos;</span>: {
        <span class="hljs-string">&apos;count_all&apos;</span>: <span class="hljs-string">&apos;count&apos;</span>,  <span class="hljs-comment"># count</span>
        <span class="hljs-string">&apos;count_distinct&apos;</span>: <span class="hljs-string">&apos;nunique&apos;</span>,  
        <span class="hljs-string">&apos;mean&apos;</span>: <span class="hljs-string">&apos;mean&apos;</span>,
        <span class="hljs-string">&apos;median&apos;</span>: <span class="hljs-string">&apos;median&apos;</span>,
        <span class="hljs-string">&apos;std&apos;</span>: <span class="hljs-string">&apos;std&apos;</span>,
        <span class="hljs-string">&apos;min&apos;</span>: <span class="hljs-string">&apos;min&apos;</span>,
        <span class="hljs-string">&apos;max&apos;</span>: <span class="hljs-string">&apos;max&apos;</span>,
    }
})
</code></pre>
<h2 id="rename-agg-columns">Rename agg columns</h2>
<pre><code class="lang-python">    grp = df.groupby([<span class="hljs-string">&apos;DC_NBR&apos;</span>, <span class="hljs-string">&apos;QUAD_ID&apos;</span>]).agg({
        <span class="hljs-string">&apos;ASSOCIATE_ID&apos;</span>: {<span class="hljs-string">&apos;count_&apos;</span>: <span class="hljs-string">&apos;nunique&apos;</span>},  <span class="hljs-comment"># distinct</span>
        <span class="hljs-string">&apos;LANE_ID&apos;</span>: {<span class="hljs-string">&apos;count_&apos;</span>: <span class="hljs-string">&apos;count&apos;</span>},
        <span class="hljs-string">&apos;VOLUME_PCT&apos;</span>: {<span class="hljs-string">&apos;sum_&apos;</span>: <span class="hljs-string">&apos;sum&apos;</span>},
    }).reset_index(inplace=<span class="hljs-keyword">False</span>)
    grp.columns = [<span class="hljs-string">&apos;&apos;</span>.join(reversed(col)).strip() <span class="hljs-keyword">for</span> col <span class="hljs-keyword">in</span> grp.columns.values]
</code></pre>
<h2 id="pivot-table--calculate-multiple-statistics-of-the-same-column">Pivot Table / Calculate multiple statistics of the same column</h2>
<pre><code class="lang-python">    pt = df.groupby([<span class="hljs-string">&apos;t4&apos;</span>])[[<span class="hljs-string">&apos;runDuration&apos;</span>]].agg([
        pd.Series.mean,
        pd.Series.std,
        pd.Series.count,
    ], as_index=<span class="hljs-keyword">False</span>).reset_index(inplace=<span class="hljs-keyword">False</span>)

    <span class="hljs-comment"># Flatten name</span>
    pt.columns = [<span class="hljs-string">&apos;&apos;</span>.join(col).strip() <span class="hljs-keyword">for</span> col <span class="hljs-keyword">in</span> pt.columns.values]
    print(pt)
</code></pre>
<h2 id="join-two-dataframe">Join two DataFrame</h2>
<pre><code class="lang-python">    df = df.merge(df1, on=[<span class="hljs-string">&apos;id&apos;</span>,<span class="hljs-string">&apos;type&apos;</span>], how=<span class="hljs-string">&apos;left&apos;</span>)
</code></pre>
<h2 id="rename-columns">Rename columns</h2>
<pre><code class="lang-python">df = df.rename(columns={
    <span class="hljs-string">&apos;latitude&apos;</span>: <span class="hljs-string">&apos;lat&apos;</span>,
    <span class="hljs-string">&apos;longitude&apos;</span>: <span class="hljs-string">&apos;lon&apos;</span>,
    <span class="hljs-string">&apos;before&apos;</span>: <span class="hljs-string">&apos;after&apos;</span>,
})
</code></pre>
<h2 id="concat-twomore-dataframes">Concat two/more DataFrames</h2>
<pre><code class="lang-python">    df = pd.concat([df1, df2, df3])  <span class="hljs-comment"># df1, df2, df3 must have same columns</span>
</code></pre>
<h2 id="convert-multi-index-into-column">Convert multi-index into column</h2>
<pre><code class="lang-python">    df.reset_index(inplace=<span class="hljs-keyword">True</span>)
</code></pre>
<h2 id="dataframe-to-list-of-dicts">DataFrame to list of dicts</h2>
<blockquote>
<p>REF: <a href="https://stackoverflow.com/questions/29815129/pandas-dataframe-to-list-of-dictionaries" target="_blank">https://stackoverflow.com/questions/29815129/pandas-dataframe-to-list-of-dictionaries</a></p>
<p>Use <code>df.T.to_dict().values()</code> or <code>df.to_dict(&apos;records&apos;)</code> (faster)
```python
In [1]: df
Out[1]:
   customer  item1   item2   item3
0         1  apple    milk  tomato
1         2  water  orange  potato
2         3  juice   mango   chips</p>
</blockquote>
<p>In [2]: df.T.to_dict().values()
Out[2]:
[{&apos;customer&apos;: 1.0, &apos;item1&apos;: &apos;apple&apos;, &apos;item2&apos;: &apos;milk&apos;, &apos;item3&apos;: &apos;tomato&apos;},
 {&apos;customer&apos;: 2.0, &apos;item1&apos;: &apos;water&apos;, &apos;item2&apos;: &apos;orange&apos;, &apos;item3&apos;: &apos;potato&apos;},
 {&apos;customer&apos;: 3.0, &apos;item1&apos;: &apos;juice&apos;, &apos;item2&apos;: &apos;mango&apos;, &apos;item3&apos;: &apos;chips&apos;}]</p>
<p>In [20]: timeit df.T.to_dict().values()
1000 loops, best of 3: 395 &#xB5;s per loop</p>
<p>In [21]: timeit df.to_dict(&apos;records&apos;)
10000 loops, best of 3: 53 &#xB5;s per loop</p>
<pre><code>
## DataFrame to dict of dict
```python

&gt;&gt;&gt; df
dc_id    store_id    osrm_miles
12       6000        123.4
12       6001        234.5
23       5801        167.5

grp = df.groupby([&apos;dc_id&apos;]) 
return {
    int(dc_id): grp.get_group(dc_id)[[&apos;store_id&apos;, &apos;miles&apos;]].set_index(&apos;store_id&apos;).T.to_dict(&apos;list&apos;)
    for dc_id in grp.groups.keys()
}  # {dc_id: {store_id: [miles]}}
</code></pre><h2 id="dataframe-to-dict">DataFrame to dict</h2>
<pre><code class="lang-python">xingDict = df.set_index(<span class="hljs-string">&apos;stree&apos;</span>)[[<span class="hljs-string">&apos;lat&apos;</span>, <span class="hljs-string">&apos;lon&apos;</span>]].to_dict(orient=<span class="hljs-string">&apos;index&apos;</span>)
</code></pre>
<blockquote>
<p>Ref: <a href="https://stackoverflow.com/questions/26716616/convert-a-pandas-dataframe-to-a-dictionary" target="_blank">https://stackoverflow.com/questions/26716616/convert-a-pandas-dataframe-to-a-dictionary</a></p>
</blockquote>
<pre><code class="lang-python">
<span class="hljs-meta">&gt;&gt;&gt; </span>df
    ID   A   B   C
<span class="hljs-number">0</span>   p    <span class="hljs-number">1</span>   <span class="hljs-number">3</span>   <span class="hljs-number">2</span>
<span class="hljs-number">1</span>   q    <span class="hljs-number">4</span>   <span class="hljs-number">3</span>   <span class="hljs-number">2</span>
<span class="hljs-number">2</span>   r    <span class="hljs-number">4</span>   <span class="hljs-number">0</span>   <span class="hljs-number">9</span>  

<span class="hljs-meta">&gt;&gt;&gt; </span>df.set_index(<span class="hljs-string">&apos;ID&apos;</span>).T.to_dict(<span class="hljs-string">&apos;list&apos;</span>)
{<span class="hljs-string">&apos;p&apos;</span>: [<span class="hljs-number">1</span>, <span class="hljs-number">3</span>, <span class="hljs-number">2</span>], <span class="hljs-string">&apos;q&apos;</span>: [<span class="hljs-number">4</span>, <span class="hljs-number">3</span>, <span class="hljs-number">2</span>], <span class="hljs-string">&apos;r&apos;</span>: [<span class="hljs-number">4</span>, <span class="hljs-number">0</span>, <span class="hljs-number">9</span>]}


<span class="hljs-meta">&gt;&gt;&gt; </span>df = pd.DataFrame({<span class="hljs-string">&apos;a&apos;</span>: [<span class="hljs-string">&apos;red&apos;</span>, <span class="hljs-string">&apos;yellow&apos;</span>, <span class="hljs-string">&apos;blue&apos;</span>], <span class="hljs-string">&apos;b&apos;</span>: [<span class="hljs-number">0.5</span>, <span class="hljs-number">0.25</span>, <span class="hljs-number">0.125</span>]})
<span class="hljs-meta">&gt;&gt;&gt; </span>df
        a      b
<span class="hljs-number">0</span>     red  <span class="hljs-number">0.500</span>
<span class="hljs-number">1</span>  yellow  <span class="hljs-number">0.250</span>
<span class="hljs-number">2</span>    blue  <span class="hljs-number">0.125</span>

<span class="hljs-meta">&gt;&gt;&gt; </span>df.to_dict(<span class="hljs-string">&apos;dict&apos;</span>)
{<span class="hljs-string">&apos;a&apos;</span>: {<span class="hljs-number">0</span>: <span class="hljs-string">&apos;red&apos;</span>, <span class="hljs-number">1</span>: <span class="hljs-string">&apos;yellow&apos;</span>, <span class="hljs-number">2</span>: <span class="hljs-string">&apos;blue&apos;</span>}, 
 <span class="hljs-string">&apos;b&apos;</span>: {<span class="hljs-number">0</span>: <span class="hljs-number">0.5</span>, <span class="hljs-number">1</span>: <span class="hljs-number">0.25</span>, <span class="hljs-number">2</span>: <span class="hljs-number">0.125</span>}}

<span class="hljs-meta">&gt;&gt;&gt; </span>df.to_dict(<span class="hljs-string">&apos;list&apos;</span>)
{<span class="hljs-string">&apos;a&apos;</span>: [<span class="hljs-string">&apos;red&apos;</span>, <span class="hljs-string">&apos;yellow&apos;</span>, <span class="hljs-string">&apos;blue&apos;</span>], 
 <span class="hljs-string">&apos;b&apos;</span>: [<span class="hljs-number">0.5</span>, <span class="hljs-number">0.25</span>, <span class="hljs-number">0.125</span>]}

<span class="hljs-meta">&gt;&gt;&gt; </span>df.to_dict(<span class="hljs-string">&apos;series&apos;</span>)
{<span class="hljs-string">&apos;a&apos;</span>: <span class="hljs-number">0</span>       red
      <span class="hljs-number">1</span>    yellow
      <span class="hljs-number">2</span>      blue
      Name: a, dtype: object, 

 <span class="hljs-string">&apos;b&apos;</span>: <span class="hljs-number">0</span>    <span class="hljs-number">0.500</span>
      <span class="hljs-number">1</span>    <span class="hljs-number">0.250</span>
      <span class="hljs-number">2</span>    <span class="hljs-number">0.125</span>
      Name: b, dtype: float64}

<span class="hljs-meta">&gt;&gt;&gt; </span>df.to_dict(<span class="hljs-string">&apos;split&apos;</span>)
{<span class="hljs-string">&apos;columns&apos;</span>: [<span class="hljs-string">&apos;a&apos;</span>, <span class="hljs-string">&apos;b&apos;</span>],
 <span class="hljs-string">&apos;data&apos;</span>: [[<span class="hljs-string">&apos;red&apos;</span>, <span class="hljs-number">0.5</span>], [<span class="hljs-string">&apos;yellow&apos;</span>, <span class="hljs-number">0.25</span>], [<span class="hljs-string">&apos;blue&apos;</span>, <span class="hljs-number">0.125</span>]],
 <span class="hljs-string">&apos;index&apos;</span>: [<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>]}

<span class="hljs-meta">&gt;&gt;&gt; </span>df.to_dict(<span class="hljs-string">&apos;records&apos;</span>)
[{<span class="hljs-string">&apos;a&apos;</span>: <span class="hljs-string">&apos;red&apos;</span>, <span class="hljs-string">&apos;b&apos;</span>: <span class="hljs-number">0.5</span>}, 
 {<span class="hljs-string">&apos;a&apos;</span>: <span class="hljs-string">&apos;yellow&apos;</span>, <span class="hljs-string">&apos;b&apos;</span>: <span class="hljs-number">0.25</span>}, 
 {<span class="hljs-string">&apos;a&apos;</span>: <span class="hljs-string">&apos;blue&apos;</span>, <span class="hljs-string">&apos;b&apos;</span>: <span class="hljs-number">0.125</span>}]

<span class="hljs-meta">&gt;&gt;&gt; </span>df.to_dict(<span class="hljs-string">&apos;index&apos;</span>)
{<span class="hljs-number">0</span>: {<span class="hljs-string">&apos;a&apos;</span>: <span class="hljs-string">&apos;red&apos;</span>, <span class="hljs-string">&apos;b&apos;</span>: <span class="hljs-number">0.5</span>},
 <span class="hljs-number">1</span>: {<span class="hljs-string">&apos;a&apos;</span>: <span class="hljs-string">&apos;yellow&apos;</span>, <span class="hljs-string">&apos;b&apos;</span>: <span class="hljs-number">0.25</span>},
 <span class="hljs-number">2</span>: {<span class="hljs-string">&apos;a&apos;</span>: <span class="hljs-string">&apos;blue&apos;</span>, <span class="hljs-string">&apos;b&apos;</span>: <span class="hljs-number">0.125</span>}}
</code></pre>
<h2 id="convert-from-string-to-numeric">Convert from string to numeric</h2>
<pre><code class="lang-python">laneDF[[<span class="hljs-string">&apos;QUAD_ID&apos;</span>,<span class="hljs-string">&apos;LANE_ID&apos;</span>,<span class="hljs-string">&apos;STORE_NBR&apos;</span>]] = laneDF[[<span class="hljs-string">&apos;QUAD_ID&apos;</span>,<span class="hljs-string">&apos;LANE_ID&apos;</span>,<span class="hljs-string">&apos;STORE_NBR&apos;</span>]].apply(pd.to_numeric)
</code></pre>
<h2 id="convert-list-of-list-to-dataframe">Convert <code>list of list</code> to DataFrame</h2>
<pre><code class="lang-python">jsonStr = <span class="hljs-string">&quot;&quot;&quot;
{
    &quot;scheduleType&quot;: 1,
    &quot;schedule&quot;: {
        &quot;dcNumber&quot;: 123,
        &quot;user&quot;: &quot;abc&quot;,
        &quot;nbrOfAssociates&quot;: 123,
        &quot;laneInfo&quot;: [
            [&quot;QUADRANT_ID&quot;, &quot;LANE_ID&quot;, &quot;STORE_NBR&quot;, &quot;LANE_OPEN&quot;],
            [&quot;1&quot;, &quot;1&quot;, &quot;1&quot;, &quot;Y&quot;],
            [&quot;2&quot;, &quot;1&quot;, &quot;2&quot;, &quot;N&quot;]
        ]
    }
}
&quot;&quot;&quot;</span>
upData = json.loads(jsonStr)
s = upData[<span class="hljs-string">&apos;schedule&apos;</span>]
headers = s[<span class="hljs-string">&apos;laneInfo&apos;</span>].pop(<span class="hljs-number">0</span>) <span class="hljs-comment"># remove top row and use it as column title</span>
laneDF = pd.DataFrame(s[<span class="hljs-string">&apos;laneInfo&apos;</span>], columns=headers)
</code></pre>
<h2 id="iloc-and-loc">iloc() and loc()</h2>
<blockquote>
<p>Ref: <a href="https://stackoverflow.com/questions/31593201/pandas-iloc-vs-ix-vs-loc-explanation-how-are-they-different" target="_blank">https://stackoverflow.com/questions/31593201/pandas-iloc-vs-ix-vs-loc-explanation-how-are-they-different</a></p>
<p>Note: in pandas version 0.20.0 and above, <code>ix</code> is deprecated and the use of <code>loc</code> and <code>iloc</code> is encouraged instead.</p>
<ul>
<li>loc gets rows (or columns) with particular labels from the index.</li>
<li>iloc gets rows (or columns) at particular positions in the index (so it only takes integers).</li>
<li>ix usually tries to behave like loc but falls back to behaving like iloc if a label is not present in the index.</li>
</ul>
</blockquote>
<pre><code class="lang-python"><span class="hljs-meta">&gt;&gt;&gt; </span>s = pd.Series(np.nan, index=[<span class="hljs-number">49</span>, <span class="hljs-number">48</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>])
<span class="hljs-meta">&gt;&gt;&gt; </span>s
<span class="hljs-number">49</span>   NaN
<span class="hljs-number">48</span>   NaN
<span class="hljs-number">1</span>    NaN
<span class="hljs-number">2</span>    NaN
<span class="hljs-number">3</span>    NaN

<span class="hljs-meta">&gt;&gt;&gt; </span>s.iloc[:<span class="hljs-number">2</span>] <span class="hljs-comment"># slice the first 2 rows</span>
<span class="hljs-number">49</span>   NaN
<span class="hljs-number">48</span>   NaN

<span class="hljs-meta">&gt;&gt;&gt; </span>s.loc[:<span class="hljs-number">2</span>] <span class="hljs-comment"># slice up to and including label 2</span>
<span class="hljs-number">49</span>   NaN
<span class="hljs-number">48</span>   NaN
<span class="hljs-number">1</span>    NaN
<span class="hljs-number">2</span>    NaN

<span class="hljs-meta">&gt;&gt;&gt; </span>s.iloc[i, <span class="hljs-string">&apos;lat&apos;</span>]  <span class="hljs-comment"># row by number and column by name</span>
</code></pre>
<h2 id="nan-filter"><code>NaN</code> filter</h2>
<pre><code class="lang-python"><span class="hljs-comment"># Take rows whose row[&apos;X&apos;] != NaN</span>
df = df[~pd.isna(df[<span class="hljs-string">&apos;X&apos;</span>])]
</code></pre>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="logging.html" class="navigation navigation-prev " aria-label="Previous page: Logging">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="python-misc-tips.html" class="navigation navigation-next " aria-label="Next page: Misc Tips">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Pandas","level":"2.8.4","depth":2,"next":{"title":"Misc Tips","level":"2.8.5","depth":2,"path":"python/python-misc-tips.md","ref":"python/python-misc-tips.md","articles":[]},"previous":{"title":"Logging","level":"2.8.3","depth":2,"path":"python/logging.md","ref":"python/logging.md","articles":[]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{},"plugins":["disqus","livereload"],"pluginsConfig":{"disqus":{"useIdentifier":false,"shortName":"wy-gitbook"},"livereload":{},"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"}},"file":{"path":"python/pandas.md","mtime":"2018-10-15T00:36:59.656Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2018-10-18T17:02:09.905Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/URI.js/1.16.1/URI.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-disqus/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-livereload/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

